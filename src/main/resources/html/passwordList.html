<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
    <title>Serach</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="../js/dateUtil.js"></script>
    <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
    <script src="../js/formUtil.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/table.css">
    <link rel="stylesheet" type="text/css" href="../css/search.css">
    <link rel="stylesheet" type="text/css" href="../css/button.css">
</head>
<body>

<div class="searchBox">
    <div class="shadow"></div>
    <input id="inp" type="text" placeholder="请输入关键字">
    <ion-icon id="but" name="search"></ion-icon>
</div>
<div class="buttonBox">
    <button class="btn btn-green"
            onclick='newWindowPage("add.html",$(this).html(),"add")'>
        新增
    </button>
</div>
<table class="hovertable" id="table">
    <!--    <button class="btn btn-default">默认</button>-->
    <!--    <button class="btn btn-bg-pink">粉色</button>-->
    <!--    <button class="btn btn-green">新增</button>-->
    <!--    <button class="btn btn-bg-green">绿色</button>-->
    <!--    <button class="btn btn-bg-blue btn-radius">修改</button>-->
    <!--    <button class="btn btn-bg-red">红色</button>-->
    <!--    <button class="btn btn-bg-gray">灰色</button>-->
    <!--    <button class="btn btn-bg-blank">黑色</button>-->
</table>
<script>
    let table = $("#table");
    $.ajaxSetup({
        accept: "application/json",
        contentType: 'application/x-www-form-urlencoded'
    });
    $("#but").click(function () {
        let key = $("#inp").val();
        let url = "http://localhost:8080/getPassword/" + key;
        $.get(url, function (response) {
            table.html("")
            table.append('<tr>\n' +
                '        <th>账号</th>\n' +
                '        <th>密码</th>\n' +
                '        <th>ip</th>\n' +
                '        <th>port</th>\n' +
                '        <th>关键词</th>\n' +
                '        <th>所属用户</th>\n' +
                '        <th>查询频率</th>\n' +
                '        <th>创建时间</th>\n' +
                '        <th>最近一次修改时间</th>\n' +
                '    </tr>')
            var list = response.result;
            for (var i = 0; i < list.length; i++) {
                let createTime = getMyDate(list[i].createTime)
                let updateTime = getMyDate(list[i].updateTime)
                // ?id='+list[i].id+
                table.append('<tr ondblclick="newWindowPage(\'update.html?id=' + list[i].id + '&&account=' + list[i].account + '&&password=' + list[i].password + '&&ip=' + list[i].ip + '&&port=' + list[i].port + '&&key=' + list[i].key + '&&user=' + list[i].user + '\')">\n' +
                    '        <td>' + list[i].account + '</td>\n' +
                    '        <td>' + list[i].password + '</td>\n' +
                    '        <td>' + list[i].ip + '</td>\n' +
                    '        <td>' + list[i].port + '</td>\n' +
                    '        <td>' + list[i].key + '</td>\n' +
                    '        <td>' + list[i].user + '</td>\n' +
                    '        <td>' + list[i].index + '</td>\n' +
                    '        <td>' + createTime + '</td>\n' +
                    '        <td>' + updateTime + '</td>\n' +
                    '    </tr>')
            }
        }, "JSON")
    })

    $(function () {
        setInterval(function () {
            console.log("setTimeout")
            let url = "http://localhost:8080/timerSelect";
            $.get(url, function (response) {
                if (response.result) {
                    $("#but").click();
                }
            }, "JSON")
        }, 2000);
    })
    $(document).keydown(function (event) {
        if (event.keyCode == 13) {
            $("#but").click()
        }
    });
</script>
</body>
</html>
